<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usu√°rios - EnorFrota</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/usuarios.css">
    <link rel="stylesheet" href="css/usuarios-principal.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/usuarios.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/usuarios-principal.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
</head>
<body>
    <!-- Bot√£o de altern√¢ncia de modo escuro -->
    <div class="botao-toggle" id="botaoToggle" onclick="alternarModoEscuro()">
        <div class="circulo"></div>
    </div>

    <!-- Barra lateral -->
    <!-- Bot√µes de menu e modo escuro -->
    <button class="menu-toggle" onclick="alternarMenu()">‚ò∞ Menu</button>
    <div class="botao-toggle" id="botaoToggle" onclick="alternarModoEscuro()">
        <div class="circulo"></div>
    </div>

    <!-- Barra lateral -->
    <div class="barra-lateral" id="barra-lateral">
        <h2>EnorFrota</h2>
        <ul>
            <li class="ativo">
                <a href="{{ url_for('index')}}">
                <i class="fas fa-home"></i> In√≠cio
                </a>
            </li>
            <li>
                <a href="{{ url_for('relatorios')}}">
                <i class="fas fa-file-alt"></i> Relat√≥rios
                </a>
            </li>
            <li>
                <a href="{{ url_for('veiculos')}}">
                <i class="fas fa-car"></i> Ve√≠culos
                </a>
            </li>
            <li>
                <a href="{{ url_for('abastecimento')}}">
                <i class="fas fa-gas-pump"></i> Abastecimento
                </a>
            </li>
            <li>
                <a href="{{ url_for('usuarios_principal')}}">
                <i class="fas fa-users"></i> Usu√°rios
                </a>
            </li>
            <li>
                <a href="{{ url_for('centrocusto')}}">
                <i class="fas fa-dollar-sign"></i> Centro de Custo
                </a>
            </li>
            <li>
                <a href="{{ url_for('base')}}">
                <i class="fas fa-building"></i> Base
                </a>
            </li>
            <li>
                <a href="{{ url_for('cartaocombustivel')}}">
                <i class="fas fa-credit-card"></i> Cart√£o
                </a>
            </li>
            <li>
                <a href="{{ url_for('logout')}}">
                <i class="fas fa-sign-in-alt"></i> Sair
                </a>
            </li>
            <!-- Exemplo de bot√£o/aba modo escuro na barra lateral -->
            <li class="modo-escuro-aba" onclick="alternarModoEscuro()">
                <i class="fas fa-moon"></i>
                <span>Modo Escuro</span>
            </li>
        </ul>

        <div class="informacoes-usuario">
            <div class="avatar-usuario">
                <img src="img/avatar.jpg" alt="Foto do Usu√°rio">
            </div>
            <div class="detalhes-usuario">
                <p>{{session.user_name}}</p>
                <p>Perfil: {{session.acesso}}</p>
            </div>
        </div>
    </div>
    <!-- Conte√∫do principal -->
    <div class="conteudo">
        <h2>Gerenciamento de Perfis</h2>
        <form id="form-usuario">
            <!-- Container para Dados Pessoais -->
            <div class="container">
                <h3>Dados pessoais</h3>
                <p>Para uma boa gest√£o de frota informe os dados do motorista.</p>
                <div class="form-group">
                    <div>
                        <label for="cpf-editar">CPF *</label>
                        <input type="text" id="CPF" name="CPF" required maxlength="14" oninput="mascaraCPF(this)">
                    </div>
                    <div>
                        <label for="rg-editar">RG</label>
                        <input type="text" id="RG" name="RG" oninput="mascaraRG(this)">
                    </div>
                    <div>
                        <label for="nome-editar">Nome *</label>
                        <input type="text" id="Nome" name="Nome" required oninput="mascaraNome(this)">
                    </div>
                    <div>
                        <label for="data-nascimento-editar">Data de nascimento *</label>
                        <input type="date" id="Data_nascimento" name="Data_nascimento" required>
                    </div>
                </div>
            </div>

            <!-- Container para Permiss√£o -->
            <div class="container">
                <h3>Permiss√£o</h3>
                <p>Defina as permiss√µes de acesso para o usu√°rio.</p>
                <div class="form-group">
                    <div>
                        <label for="permissao-acesso">N√≠vel de Acesso</label>
                        <div class="custom-select">
                            <select id="Nivel_acesso" name="Nivel_acesso" onchange="atualizarDescricaoPermissao()">
                                <option value="admin">Administrador</option>
                                <option value="gestor">Gestor</option>
                                <option value="controlador">Controlador</option>
                                <option value="motorista">Motorista</option>
                                <option value="operador">Operador de Campo</option>
                                <option value="personalizado">Personalizado</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Container para a descri√ß√£o do n√≠vel de acesso -->
                <div id="descricao-permissao">
                    <!-- O texto da descri√ß√£o ser√° inserido aqui dinamicamente -->
                </div>
            </div>

            <!-- Container para Dados de Contato -->
            <div class="container">
                <h3>Dados de Login</h3>
                <p>Vamos incluir os dados de login para usar o Enorfrota.</p>
                <div class="form-group">
                    <div>
                        <label for="email-editar">E-mail</label>
                        <input type="email" id="Email" name="Email">
                    </div>
                    <div>
                        <label for="Senha-editar">Senha</label>
                        <input type="text" id="Senha" name="Senha" maxlength="4" oninput="mascaraSenha(this)">
                    </div>
                </div>
            </div>
                
            <!-- Container para Dados da CNH -->
            <div class="container">
                <h3>Dados da CNH</h3>
                <p>Aqui voc√™ deve informar os dados da carteira do motorista, a fim de gerenciar quais os tipos de ve√≠culos que ele pode dirigir e o vencimento de sua habilita√ß√£o.</p>
                <div class="form-group">
                    <div>
                        <label for="cnh-numero-editar">N√∫mero CNH</label>
                        <input type="text" id="CNH" name="CNH" maxlength="9" oninput="mascaraCNH(this)">
                    </div>
                    <div>
                        <label for="cnh-categoria-editar">Categoria</label>
                        <select id="Categoria_CNH" name="Categoria_CNH">
                            <option value="">Selecione a categoria</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                    <div>
                        <label for="cnh-validade-editar">Validade</label>
                        <input type="date" id="Validade_CNH" name="Validade_CNH" onchange="verificarValidadeCNH()">
                    </div>
                </div>
            </div>

            <!-- Container para Associa√ß√£o -->
            <div class="container">
                <h3>Associa√ß√£o</h3>
                <p>Aqui voc√™ cadastra as informa√ß√µes adicionais associadas ao seu motorista, como a matr√≠cula.</p>
                <div class="form-group">
                    <div>
                        <label for="veiculo-editar">Placa Ve√≠culo</label>
                        <input type="text" id="Placa" name="Placa" maxlength="7" oninput="validarPlaca(this)">
                    </div>
                    <div>
                        <label for="centro-custo-editar">Centro de Custo</label>
                        <input type="text" id="CentroCusto" name="CentroCusto">
                    </div>
                    <div>
                        <label for="placa-cart√£o-editar">Placa Cart√£o </label>
                        <input type="text" id="ID_Cartao" name="ID_Cartao" maxlength="7">
                    </div>
                </div>
            </div>

            <!-- Container para Status -->
            <div class="container">
                <h3>Status</h3>
                <p>Selecione o status atual do usu√°rio.</p>
                <div class="status-group">
                    <button type="button" class="status-btn ativo" data-status="ativo">
                        <i class="fas fa-check-circle"></i> Ativo
                    </button>
                    <button type="button" class="status-btn inativo" data-status="inativo">
                        <i class="fas fa-times-circle"></i> Inativo
                    </button>
                    <button type="button" class="status-btn ferias" data-status="ferias">
                        <i class="fas fa-umbrella-beach"></i> F√©rias
                    </button>
                    <input type="hidden" id="Status" name="Status" value="ativo">
                </div>
            </div>

            <!-- Bot√µes de a√ß√£o -->
            <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                <button type="button" class="btn-cancelar" onclick="voltarParaUsuariosPrincipal()">Cancelar</button>
                <button type="submit" class="btn-salvar">Salvar</button>
            </div>
        </form>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="modal-confirmacao" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirma√ß√£o</h2>
                <span class="close" onclick="fecharModalConfirmacao()">&times;</span>
            </div>
            <div class="modal-body">
                <p>Tem certeza de que deseja salvar as altera√ß√µes?</p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancelar" onclick="fecharModalConfirmacao()">Cancelar</button>
                <button type="button" class="btn-salvar" onclick="confirmarAlteracoes()">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        // Verifica o estado do modo escuro ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            const isDarkMode = localStorage.getItem('modoEscuro') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
        });

        // Alterna o modo escuro e salva o estado no localStorage
        function alternarModoEscuro() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            localStorage.setItem('modoEscuro', isDarkMode);
        }

        // Fun√ß√£o para abrir o modal
        function abrirModal(botao) {
            const linha = botao.closest('tr');
            const colunas = linha.querySelectorAll('td');

            // Preenche os campos do modal com os dados da linha
            document.getElementById('modal-nome-perfil').value = colunas[0].textContent.trim();
            document.getElementById('modal-descricao-perfil').value = colunas[3].textContent.trim();
            document.getElementById('modal-status-perfil').value = colunas[2].textContent.trim().toLowerCase();

            // Exemplo: Preencher os checkboxes de permiss√µes (ajuste conforme necess√°rio)
            document.getElementById('modal-permissao-estoque-visualizar').checked = true; // Exemplo
            document.getElementById('modal-permissao-estoque-editar').checked = false; // Exemplo
            document.getElementById('modal-permissao-estoque-excluir').checked = true; // Exemplo

            // Exibe o modal
            document.getElementById('modal-editar').style.display = 'flex';
        }

        // Fun√ß√£o para fechar o modal
        function fecharModal() {
            // Oculta o modal
            document.getElementById('modal-editar').style.display = 'none';
        }

        // Fun√ß√£o para salvar as permiss√µes (exemplo)
        function salvarPermissoes() {
            const estoqueVisualizar = document.getElementById('modal-permissao-estoque-visualizar').checked;
            const estoqueEditar = document.getElementById('modal-permissao-estoque-editar').checked;
            const estoqueExcluir = document.getElementById('modal-permissao-estoque-excluir').checked;

            console.log('Permiss√µes Estoque:', { estoqueVisualizar, estoqueEditar, estoqueExcluir });
            // Adicione l√≥gica para salvar as permiss√µes no backend ou atualizar a tabela
        }

        // Fun√ß√£o para inativar a linha
        function inativarLinha(botao) {
            const linha = botao.closest('tr'); // Encontra a linha correspondente
            linha.classList.add('linha-inativa'); // Adiciona a classe de inativo
            const statusColuna = linha.querySelector('td:nth-child(3)'); // Seleciona a coluna de status
            if (statusColuna) {
                statusColuna.textContent = 'Inativo'; // Atualiza o status para "Inativo"
            }

            // Substitui o bot√£o "Excluir" pelo bot√£o "Ativar"
            const acoesColuna = linha.querySelector('td:last-child'); // Seleciona a coluna de a√ß√µes
            acoesColuna.innerHTML = `
                <button class="botao-ativar" onclick="abrirModalConfirmacao(this)">
                    <i class="fas fa-check"></i> Ativar
                </button>
            `;
        }

        let linhaParaAtivar = null; // Vari√°vel para armazenar a linha a ser ativada

        // Fun√ß√£o para abrir o modal de confirma√ß√£o
        function abrirModalConfirmacao(botao) {
            linhaParaAtivar = botao.closest('tr'); // Armazena a linha correspondente
            document.getElementById('modal-confirmar-ativacao').style.display = 'flex'; // Exibe o modal
        }

        // Fun√ß√£o para fechar o modal de confirma√ß√£o
        function fecharModalConfirmacao() {
            linhaParaAtivar = null; // Reseta a linha armazenada
            document.getElementById('modal-confirmar-ativacao').style.display = 'none'; // Oculta o modal
        }

        // Fun√ß√£o para confirmar a ativa√ß√£o
        function confirmarAtivacao() {
            if (linhaParaAtivar) {
                linhaParaAtivar.classList.remove('linha-inativa'); // Remove a classe de inativo
                const statusColuna = linhaParaAtivar.querySelector('td:nth-child(3)'); // Seleciona a coluna de status
                if (statusColuna) {
                    statusColuna.textContent = 'Ativo'; // Atualiza o status para "Ativo"
                }

                // Substitui o bot√£o "Ativar" pelo bot√£o "Excluir"
                const acoesColuna = linhaParaAtivar.querySelector('td:last-child'); // Seleciona a coluna de a√ß√µes
                acoesColuna.innerHTML = `
                    <button class="botao-editar" onclick="abrirModal(this)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="botao-excluir" onclick="inativarLinha(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
            }

            fecharModalConfirmacao(); // Fecha o modal de confirma√ß√£o
        }

        // Fun√ß√£o para redirecionar para a aba "usuarios-principal"
        function voltarParaUsuariosPrincipal() {
            window.location.href = '{{url_for("usuarios_principal")}}'; // Redireciona para a p√°gina principal de usu√°rios
        }

        // Fun√ß√£o para exibir uma notifica√ß√£o de "Salvo" e redirecionar
        function mostrarNotificacaoSalvo() {
            // Cria o elemento de notifica√ß√£o
            const notificacao = document.createElement('div');
            notificacao.textContent = 'Altera√ß√µes salvas com sucesso!';
            notificacao.style.position = 'fixed';
            notificacao.style.top = '20px'; // Posiciona no topo
            notificacao.style.left = '50%'; // Centraliza horizontalmente
            notificacao.style.transform = 'translateX(-50%)'; // Ajusta para o centro
            notificacao.style.backgroundColor = '#4CAF50';
            notificacao.style.color = 'white';
            notificacao.style.padding = '10px 20px';
            notificacao.style.borderRadius = '5px';
            notificacao.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.3)';
            notificacao.style.zIndex = '1000';

            // Adiciona a notifica√ß√£o ao corpo do documento
            document.body.appendChild(notificacao);

            // Remove a notifica√ß√£o ap√≥s 3 segundos e redireciona
            setTimeout(() => {
                notificacao.remove();
                window.location.href = 'usuarios-principal.html'; // Redireciona para a p√°gina principal
            }, 3000);
        }

        // Fun√ß√£o para atualizar a descri√ß√£o do n√≠vel de acesso
        function atualizarDescricaoPermissao() {
            const select = document.getElementById('Nivel_acesso');
            const descricaoContainer = document.getElementById('descricao-permissao');
            const nivelSelecionado = select.value;

            // Descri√ß√µes para cada n√≠vel de acesso
            const descricoes = {
                admin: `üßë‚Äçüíª <strong>Administrador</strong><br>
                        <ul>
                            <li>Acesso total a todas as p√°ginas e funcionalidades</li>
                            <li>Cadastrar, editar e excluir:
                                <ul>
                                    <li>Usu√°rios</li>
                                    <li>Ve√≠culos</li>
                                    <li>Abastecimentos</li>
                                    <li>Centros de custo</li>
                                    <li>Bases</li>
                                </ul>
                            </li>
                            <li>Acessar todos os relat√≥rios (com filtros avan√ßados)</li>
                            <li>Exportar dados (PDF/Excel)</li>
                            <li>Gerenciar permiss√µes dos demais usu√°rios</li>
                            <li>Ver todos os dados da empresa</li>
                        </ul>`,
                gestor: `üë®‚Äçüíº <strong>Gestor</strong><br>
                        <ul>
                            <li>Visualizar e editar:
                                <ul>
                                    <li>Ve√≠culos</li>
                                    <li>Abastecimentos</li>
                                    <li>Centros de custo</li>
                                </ul>
                            </li>
                            <li>Visualizar relat√≥rios completos (exceto de usu√°rios e permiss√µes)</li>
                            <li>Visualizar dados de usu√°rios, mas sem editar</li>
                            <li>Exportar relat√≥rios</li>
                            <li>Ver dados de todas as bases</li>
                        </ul>`,
                controlador: `üßæ <strong>Controlador</strong><br>
                        <ul>
                            <li>Registrar e editar abastecimentos</li>
                            <li>Cadastrar e editar ve√≠culos (mas n√£o excluir)</li>
                            <li>Visualizar relat√≥rios parciais (abastecimento e ve√≠culos)</li>
                            <li>Visualizar centro de custo e base</li>
                            <li>Sem acesso √† gest√£o de usu√°rios</li>
                            <li>Sem permiss√£o para mudar configura√ß√µes ou permiss√µes</li>
                        </ul>`,
                motorista: `üöó <strong>Motorista</strong><br>
                        <ul>
                            <li>Registrar seus pr√≥prios abastecimentos</li>
                            <li>Visualizar apenas:
                                <ul>
                                    <li>Seus ve√≠culos designados</li>
                                    <li>Seus pr√≥prios relat√≥rios (km rodado, consumo, etc.)</li>
                                </ul>
                            </li>
                            <li>Sem acesso a outros usu√°rios, centros de custo ou bases</li>
                            <li>Sem edi√ß√£o ou exclus√£o de dados</li>
                        </ul>`,
                operador: `üõ†Ô∏è <strong>Operador de Campo</strong><br>
                        <ul>
                            <li>Visualizar ve√≠culos e abastecimentos (somente leitura)</li>
                            <li>Registrar ocorr√™ncias b√°sicas (ex: solicitar manuten√ß√£o ou informar anomalia)</li>
                            <li>Ver relat√≥rios pr√≥prios ou do setor, se necess√°rio</li>
                            <li>Sem acesso a usu√°rios, centros de custo ou base</li>
                            <li>Sem permiss√£o para editar nada</li>
                        </ul>`,
                personalizado: `<strong>Personalizado</strong><br>
                        <p>O n√≠vel Personalizado permite configurar permiss√µes espec√≠ficas para o usu√°rio.</p>`
            };

            // Atualiza o texto da descri√ß√£o com base no n√≠vel selecionado
            descricaoContainer.innerHTML = descricoes[nivelSelecionado] || '';
            descricaoContainer.style.display = 'block'; // Exibe o container
        }

        // Fun√ß√£o para selecionar status
        document.querySelectorAll('.status-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.getElementById('Status').value = this.getAttribute('data-status');
                document.querySelectorAll('.status-btn').forEach(b => b.classList.remove('selecionado'));
                this.classList.add('selecionado');
            });
        });

        // Substitua o submit do formul√°rio por este c√≥digo:
        document.getElementById("form-usuario").addEventListener("submit", async function(event) {
    event.preventDefault();

            // Monta o objeto com os campos conforme o backend espera
            const funcionario = {
        Nome: document.getElementById("Nome").value,
        RG: document.getElementById("RG").value,
        CPF: document.getElementById("CPF").value,
        CentroCusto: document.getElementById("CentroCusto").value,
        CNH: document.getElementById("CNH").value,
        Categoria_CNH: document.getElementById("Categoria_CNH").value,
        Validade_CNH: document.getElementById("Validade_CNH").value,
        Nivel_acesso: document.getElementById("Nivel_acesso").value,
        Data_nascimento: document.getElementById("Data_nascimento").value,
        Placa: document.getElementById("Placa").value,
        ID_Cartao: document.getElementById("ID_Cartao").value,
        Email: document.getElementById("Email").value,
        Senha: document.getElementById("Senha").value
    };

    try {
        const resposta = await fetch('http://127.0.0.1:5000/api/funcionarios', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(funcionario)
        });

                const resultado = await resposta.json();

                if (resposta.ok) {
                    mostrarNotificacaoSalvo();
                } else {
                    alert("Erro ao salvar: " + (resultado.erro || "Erro desconhecido"));
                }
            } catch (erro) {
                alert("Erro de conex√£o com o servidor.");
            }
        });

        // M√°scara para CPF
        function mascaraCPF(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            input.value = value;
        }

        // M√°scara para RG
        function mascaraRG(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 9) value = value.slice(0, 9);
            value = value.replace(/(\d{2})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1})$/, '$1-$2');
            input.value = value;
        }

        // Limitar N√∫mero CNH a 9 d√≠gitos num√©ricos
        function mascaraCNH(input) {
            input.value = input.value.replace(/\D/g, '').slice(0, 9);
        }

        // Limitar senha a 4 caracteres num√©ricos
        function mascaraSenha(input) {
            input.value = input.value.replace(/\D/g, '').slice(0, 4);
        }

        // Permitir apenas letras no campo Nome
        function mascaraNome(input) {
            input.value = input.value.replace(/[^a-zA-Z√Ä-√ø\s]/g, '');
        }

        // Verifica se a data de validade da CNH est√° vencida
        function verificarValidadeCNH() {
            const input = document.getElementById('Validade_CNH');
            if (!input.value) return;
            const partes = input.value.split('-');
            // yyyy-mm-dd para Date
            const dataInformada = new Date(partes[0], partes[1] - 1, partes[2]);
            const hoje = new Date();
            hoje.setHours(0,0,0,0);

            if (dataInformada < hoje) {
                alert('A CNH est√° vencida!');
            }
        }

        // Valida√ß√£o para placa: exatamente 4 letras e 3 n√∫meros (qualquer ordem, mas n√£o mais que isso)
        function validarPlaca(input) {
            let value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');

            // Limita a 7 caracteres totais
            value = value.slice(0, 7);

            // Conta letras e n√∫meros
            let letras = (value.match(/[A-Z]/g) || []).length;
            let numeros = (value.match(/[0-9]/g) || []).length;

            // Remove letras extras se j√° houver 4
            if (letras > 4) {
                let nova = '';
                let countL = 0, countN = 0;
                for (let c of value) {
                    if (/[A-Z]/.test(c) && countL < 4) {
                        nova += c;
                        countL++;
                    } else if (/[0-9]/.test(c) && countN < 3) {
                        nova += c;
                        countN++;
                    }
                    if (nova.length === 7) break;
                }
                value = nova;
            }

            // Remove n√∫meros extras se j√° houver 3
            letras = (value.match(/[A-Z]/g) || []).length;
            numeros = (value.match(/[0-9]/g) || []).length;
            if (numeros > 3) {
                let nova = '';
                let countL = 0, countN = 0;
                for (let c of value) {
                    if (/[A-Z]/.test(c) && countL < 4) {
                        nova += c;
                        countL++;
                    } else if (/[0-9]/.test(c) && countN < 3) {
                        nova += c;
                        countN++;
                    }
                    if (nova.length === 7) break;
                }
                value = nova;
            }

            input.value = value;

            // Valida√ß√£o final: s√≥ aceita se tiver exatamente 4 letras e 3 n√∫meros
            letras = (value.match(/[A-Z]/g) || []).length;
            numeros = (value.match(/[0-9]/g) || []).length;
            if (value.length === 7 && letras === 4 && numeros === 3) {
                input.setCustomValidity('');
            } else {
                input.setCustomValidity('A placa deve conter exatamente 4 letras e 3 n√∫meros.');
            }
        }
    </script>
</body>
</html>